# ADR-001: Выбор архитектуры аутентификации

## Статус

Принято

## Дата

2025-11-29

## Участники

- Архитектор системы
- Lead Backend Developer
- Lead Frontend Developer
- Security Engineer

## Контекст

Проект Taskorium требует надежной системы аутентификации и авторизации для управления доступом к задачам, проектам и
другим ресурсам. Необходимо выбрать подход, который обеспечит:

- Безопасность пользовательских данных
- Масштабируемость системы
- Удобство разработки и поддержки
- Соответствие современным стандартам

## Рассмотренные варианты

### Вариант 1: Прямая аутентификация клиента с Keycloak

**Описание:** Клиентские приложения напрямую взаимодействуют с Keycloak для получения токенов, которые затем передаются
в API Gateway.

**Плюсы:**

- ✅ Соответствие стандартам OAuth 2.0 и OpenID Connect
- ✅ Высокая безопасность (пароли не проходят через наш бэкенд)
- ✅ Лучшая производительность (меньше нагрузки на Gateway)
- ✅ Проще реализация refresh token flow
- ✅ Легче интегрировать сторонние OAuth провайдеры

**Минусы:**

- ❌ Требует настройки CORS для клиентских приложений
- ❌ Сложнее обрабатывать кастомные сценарии аутентификации

### Вариант 2: Прокси-аутентификация через API Gateway

**Описание:** Все запросы на аутентификацию проходят через API Gateway, который проксирует их в Keycloak.

**Плюсы:**

- ✅ Единая точка входа для всех auth операций
- ✅ Возможность добавить кастомную логику аутентификации
- ✅ Легче менять провайдера аутентификации в будущем

**Минусы:**

- ❌ Пароли проходят через наш сервер (дополнительный риск)
- ❌ Дополнительная нагрузка на Gateway
- ❌ Сложнее реализовать стандартные OAuth flows

### Вариант 3: Кастомная система аутентификации

**Описание:** Разработка собственной системы аутентификации с нуля.

**Плюсы:**

- ✅ Полный контроль над логикой аутентификации
- ✅ Нет зависимостей от внешних сервисов

**Минусы:**

- ❌ Высокие затраты на разработку и поддержку
- ❌ Риск security уязвимостей
- ❌ Сложность реализации современных стандартов

## Решение

Выбран **Вариант 1: Прямая аутентификация клиента с Keycloak** с гибридным подходом для разных типов клиентов.

### Детали реализации:

#### Для веб-клиентов (SPA):

```javascript
// Прямое взаимодействие с Keycloak
const keycloak = new Keycloak({
    url: 'https://auth.taskorium.com',
    realm: 'taskorium',
    clientId: 'taskorium-web'
});